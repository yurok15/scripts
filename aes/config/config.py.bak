#settings

import os
import sys

# filters available on this configuration
import multiprocessing
from ipaddress import ip_network
from aes.conf.default_settings import SERVICES

HTTP_SERVER={'debug': False, 'port': 8000, 'host': '0.0.0.0'}

LOOP_LIMIT = 5
DEBUG = False
HELLO_STRING = "AESv2 Core "+os.uname()[1]

INTERNAL_NETWORKS = (
    ip_network("127.0.0.0/24"),
    ip_network("64.78.0.0/18"),
    ip_network("206.40.48.0/22"),
    ip_network("206.225.164.0/24"),
    ip_network("10.254.0.0/16"),
    ip_network("10.240.0.0/16"),
)

SERVICES = [
  ('http', 'aes.services.http.HttpService'),
  ('smtp', 'aes.services.smtp.SMTPService'),
  ('prometheus', 'aes.services.prometheus.PrometheusService'),
  ('config', 'aes.services.config.ConfigService'),
]

SMTP_SERVER = {
    'host': '0.0.0.0',
    'port': 1025,
    'ssl': None,
    'starttls': {
        'cert': '/etc/ssl/certs/aesc022-va-1-1.serverpod.net.cer',
        'key': '/etc/ssl/private/aesc022-va-1-1.serverpod.net.key'
    },
}


FILTERS_SETTINGS = {
    'clamav': {
        'path': '/var/run/clamav/clamd.ctl',
        'timeout': 60,
        'retry_attempts': 3,
        'limit': 10,
        'fast_plain_text': True,
        'quarantine': {
            'class': 'aes.delivery.FolderDelivery',
            'path': '/opt/aes/quarantine',
            'prefix': 'virus-'
        },
        'cache_ttl': 15*60,
        'cache_lru': 5000,
    },
    'cyren': {
        'host': '127.0.0.1',
        'port': 8088,
        'timeout': 60,
        'retry_attempts': 3,
        'limit': 10,
        'fast_plain_text': True,
        'spam_support': False,
        'cache_ttl': 15*60,
        'cache_lru': 5000,
    },
    'cyren_av': {
        'host': '127.0.0.1',
        'port': 2705,
        'timeout': 60,
        'retry_attempts': 3,
        'limit': 10,
        'fast_plain_text': True,
        'cache_ttl': 15*60,
        'cache_lru': 5000,
    },
    'sophos': {
        'host': '127.0.0.1',
        'port': 4010,
        'timeout': 60,
        'retry_attempts': 3,
        'limit': 10,
        'fast_plain_text': False,
    },
    'vade_retro': {
        'host': '127.0.0.1',
        'port': 11025,
	'sleep': 0,
        'timeout': 60,
        'retry_attempts': 3,
        'limit': 10,
        'cache_ttl': 15*60,
        'cache_lru': 5000,
    },
    'white_black': {
        'internal_networks': INTERNAL_NETWORKS
    },
    'url_protection': {
        'urlresolver_url': 'https://url.serverdata.net',
        'SECRET_KEY': 'lORSLyxpMKrLCwadEiNbCiUtTOwipGVC',
    },
    'mailflow': {
        'action': 'pass',
        'SOURCE_IP_MISSED': [
            {
                'peer': [],
                'chain': []
            },
        ],
        'SOURCE_IP_PRESENT': [
            {
                'peer': [],
                'chain': []
            },
        ],
    },
}

POLICY_SERVICE = {
    'url': "http://uppls-va-1.wh.intermedia.net:80",

    'pool_limit': 0,
    'timeout': 60,
    'inbound': True,
    'global': {
        'ttl': 60,
        'lru': 1,
    },
    'group': {
        'ttl': 5*60,
        'lru': 1000,
    },
    'personal': {
        'ttl': 5*60,
        'lru': 1000,
    },
}

protection_host, protection_port = 'upmt-va-1.serverpod.net:25'.split(':')

DELIVERY = {
    'bounce': {
        'class': 'aes.delivery.FolderDelivery',
        'path': '/opt/aes/quarantine',
        'prefix': 'bounce-',
        'gzip': True,
    },
    'send': {
        'class': 'aes.delivery.UrlProtectionDelivery',
        'service_url': "http://uppls-va-1.wh.intermedia.net:80",
        'protection_host': (protection_host, protection_port),
        'others_host': ('aesmt022-va-1.serverpod.net', 10025),
        'starttls': {
            'cert': '/etc/ssl/certs/aesc022-va-1-1.serverpod.net.cer',
            'key': '/etc/ssl/private/aesc022-va-1-1.serverpod.net.key'
        },
    },
    'quarantine': {
        'class': 'aes.delivery.QuarantineDelivery',
        'command_encoding': 'utf-8',
        'ssl': None,
        'starttls': {
            'cert': '/etc/ssl/certs/aesc022-va-1-1.serverpod.net.cer',
            'key': '/etc/ssl/private/aesc022-va-1-1.serverpod.net.key'
        },
    },
    'lsa_quarantine': {
        'class': 'aes.delivery.FolderDelivery',
        'path': '/opt/aes/quarantine',
        'gzip': True,
        'prefix': 'spam-'
    },
    'deny': {
        'class': 'aes.delivery.FolderDelivery',
        'path': '/opt/aes/quarantine',
        'prefix': 'deny-',
        'gzip': True,
    }
}

LOGGING = {
    'version': 1,
    'disable_existing_loggers': True,
    'formatters': {
        'verbose': {
            'format': '%(name)s %(levelname)s %(asctime)s %(message)s %(extra)s'
        },
        'simple': {
            'format': '%(levelname)s %(message)s %(extra)s'
        },
    },
    'filters': {
        'user_context': {
            '()': 'aes.core.filters.ContextFilter'
        },
        'console_filter': {
            '()': 'aes.core.filters.ConsoleFilter'
        }
    },
    'handlers': {
        'null': {
            'level': 'INFO',
            'class': 'logging.FileHandler',
            'filename': 'ext://os.devnull',
        },
        'console': {
            'level': 'INFO',
            'class': 'logging.StreamHandler',
            'filters': ['console_filter'],
            'formatter': 'simple',
            'stream': 'ext://sys.stderr',
        },
        'syslog': {
            'level': 'INFO',
            'class': 'logging.handlers.SysLogHandler',
            'filters': ['console_filter'],
            'formatter': 'simple',
            'address': ('10.216.233.19', 514),
            'facility': 'mail',
        },
        'logstash': {
            'level': 'INFO',
            'class': 'aes.core.logstash_cluster.LogstashClusterUDPHandler',
            'filters': ['user_context'],
            'hosts': [('aeslog-va-1-1.serverpod.net', 11011), ('aeslog-va-1-2.serverpod.net', 11011), ('aeslog-va-1-3.serverpod.net', 11011), ],
            'version': 1,
        },
    },
    'loggers': {
        'aiohttp.access': {
            'level': 'WARNING',
            'propagate': False,
        },
        'elasticsearch': {
            'level': 'ERROR',
        },
        'startup': {
            'level': 'INFO',
            'handlers': ['console'],
        }
    },
    'root': {
        'handlers': ['syslog', 'logstash'],
        'level': 'INFO',
    }
}

ELASTIC_SEARCH = {
    'hosts': [ 'aeslog-va-1-1.serverpod.net:9201', 'aeslog-va-1-2.serverpod.net:9201', 'aeslog-va-1-3.serverpod.net:9201', ],
    'auth': ('admin', 'kjgHJJHfhg543S'),
    'indexes': {
        'analytics': 'aes_analytics-*',
        'logs': 'aes_events-*'
    },
    'timeout': 60,
}


PROCESS_NUM = multiprocessing.cpu_count()

DATA_SIZE_LIMIT = 62914560
SMTP_8BIT_ENCODING = 'latin1'
