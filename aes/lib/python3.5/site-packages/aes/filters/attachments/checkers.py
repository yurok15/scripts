import re

KB = 1024


def _match(value, rule):
    exp = '^%s$' % rule.replace('.', r'\.').replace('*', '.*')
    return bool(re.match(exp, value))


def mime_type(att_info, rules):
    rules = rules or []
    for rule in rules:
        if _match(att_info.mime_type, rule):
            return True
    return False


def file_name(att_info, rules):
    rules = rules or []
    for rule in rules:
        if _match(att_info.file_name, rule):
            return True
    return False


def size(att_info, rules):
    rules = rules or {}
    _size = att_info.size
    gte = rules.get('greater_than')
    lte = rules.get('lesser_than')
    if gte and not _size >= gte * KB:
        return False
    if lte and not _size <= lte * KB:
        return False
    if all(op is None for op in [gte, lte]):
        return False
    return True


def content_disposition(att_info, rules):
    return att_info.disposition == rules


def default_checkers():
    return {
        'file_name': file_name,
        'mime_type': mime_type,
        'size': size,
        'content_disposition': content_disposition,
    }
