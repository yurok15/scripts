from .checkers import default_checkers


class ConditionChecker:
    def __init__(self, checkers=None):
        self.checkers = checkers or default_checkers()

    def check(self, att_info, condition):
        """
        :param aes.core.message_info.AttachInfo att_info:
        """
        for checker_name, rules in condition.items():
            if checker_name == '$and':
                checker = self._and
            elif checker_name == '$not':
                checker = self._not
            else:
                checker = self.checkers[checker_name]
            if checker(att_info, rules):
                return True
        return False

    def _and(self, att_info, rules):
        for condition in rules:
            if not self.check(att_info, condition):
                return False
        return True

    def _not(self, att_info, condition):
        return not self.check(att_info, condition)
