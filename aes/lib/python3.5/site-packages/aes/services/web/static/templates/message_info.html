<h1>
    <button class="btn btn-primary" ui-sref="^">
        <span class="glyphicon glyphicon-arrow-left"></span>
    </button>
    Message info
</h1>
<table class="table">
    <thead>
        <tr>
            <th>Time</th>
            <th>From</th>
            <th>To</th>
            <th>In size</th>
            <th>Out size</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>{{ msg.time }}</td>
            <td>
                <p ng-class="{true: 'text-primary', false: ''}[
                msg.usr_mail_from==msg.user]">
                    {{ msg.usr_mail_from }}
                </p>
            </td>
            <td>
                <p ng-class="{true: 'text-primary', false: ''}[
                msg.usr_mail_to==msg.user]">
                    {{ msg.usr_mail_to }}
                </p>
            </td>
            <td>{{ msg.in_size }}</td>
            <td>{{ msg.out_size }}</td>
        </tr>
    </tbody>
</table>

<h3>Delivery</h3>
<table class="table">
    <tbody>
        <tr class="info">
            <td>Mailbox</td>
            <td>
                <span ng-if="msg.delivery=='send'" class="label label-success">
                    Send
                </span>
                <span ng-if="msg.delivery!='send'" class="label label-danger">
                    Blocked
                </span>
            </td>
            <td>
                <span ng-if="msg.delivery=='send'">
                    Delivered to:
                    <span ng-repeat="(param,value) in msg.delivery_relay">
                        {{ param }}: {{ value }}
                    </span>
                </span>
                <span ng-if="msg.delivery=='error'">
                    Unexpected error happened.
                </span>
                <span ng-if="msg.delivery!='error'"
                      ng-hide="msg.delivery=='send'">
                    One of filters decided to block delivery to mailbox.
                </span>
            </td>
        </tr>
        <tr ng-if="msg.quarantine_relay.path" class="warning">
            <td>LSA Quaranine</td>
            <td>
                <span class="label label-success">Saved</span>
            </td>
            <td>
                {{ msg.host }}: {{ msg.quarantine_relay.path }}
            </td>
        </tr>
        <tr ng-if="msg.quarantine_type=='admin'" class="warning">
            <td>Admin Quarantine</td>
            <td>
                <span class="label label-success">Saved</span>
            </td>
            <td>
                Delivered to:
                <span ng-repeat="(param,value) in msg.quarantine_relay">
                    {{ param }}: {{ value }}
                </span>
            </td>
        </tr>
        <tr ng-if="msg.quarantine_type=='user'" class="warning">
            <td>User quarantine</td>
            <td>
                <span class="label label-success">Saved</span>
            </td>
            <td>
                Delivered to:
                <span ng-repeat="(param,value) in msg.quarantine_relay">
                    {{ param }}: {{ value }}
                </span>
            </td>
        </tr>
    </tbody>
</table>


<h3>Filtering</h3>
<table class="table" ng-hide="msg.x_aes_category">
    <thead>
        <tr>
            <th style="width: 100px;">Categroty</th>
            <th style="width: 70px;">State</th>
            <th>Info</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>SPF</td>
            <td>
                <span class="label"
                      ng-class="filter_class(msg.filters.spf, 'spf')">
                    {{ filter_label(msg.filters.spf, 'spf') }}
                </span>
            </td>
            <td>
                <span ng-if="msg.x_spf_status">
                    Status: {{ msg.x_spf_status }}
                </span>
            </td>
        </tr>
        <tr>
            <td>Black list</td>
            <td>
                <span class="label"
                      ng-class="filter_class(msg.filters.white_black, 'blk')">
                    {{ filter_label(msg.filters.white_black, 'blk') }}
                </span>
            </td>
            <td>
                <span ng-hide="msg.filters.white_black=='passed'">
                    {{ msg.filters.white_black }}
                </span>
            </td>
        </tr>
        <tr>
            <td>Phishing</td>
            <td>
                <span class="label"
                      ng-class="filter_class(msg.filters.phishing, 'phsh')">
                    {{ filter_label(msg.filters.phishing, 'phsh') }}
                </span>
            </td>
            <td></td>
        </tr>
        <tr>
            <td>Antivirus</td>
            <td>
                <span class="label"
                      ng-class="filter_class(msg.filters.antivirus, 'av')">
                    {{ filter_label(msg.filters.antivirus, 'av') }}
                </span>
            </td>
            <td>
                <span ng-if="msg.filters.antivirus=='virus'">
                    Virus signature found.
                </span>
            </td>
        </tr>
        <tr>
            <td>Cloudmark</td>
            <td>
                <span class="label"
                      ng-class="filter_class(msg.filters.spam, 'cloudmark')">
                    {{ filter_label(msg.filters.spam, 'cloudmark') }}
                </span>
            </td>
            <td>
                <span ng-if="msg.x_cmae_score">
                    Cloudmark spam score: {{ msg.x_cmae_score }}
                </span>
            </td>
        </tr>
        <tr>
            <td>VadeRetro</td>
            <td>
                <span class="label"
                      ng-class="filter_class(msg.filters.spam, 'vaderetro')">
                    {{ filter_label(msg.filters.spam, 'vaderetro') }}
                </span>
            </td>
            <td>
                <div ng-if="msg.x_spam_category">
                    <div>Category: {{ msg.x_spam_category }}</div>
                    <div>Score: {{ msg.x_spam_score }}</div>
                    <div style="word-break: break-all;">
                        Reasons: {{ msg.x_spam_reasons }}
                    </div>
                </div>
            </td>        </tr>
        <tr>
            <td>Attachments</td>
            <td>
                <span class="label"
                      ng-class="filter_class(msg.filters.attachments, 'att')">
                    {{ filter_label(msg.filters.attachments, 'att') }}
                </span>
            </td>
            <td>
                <span ng-if="msg.filters.attachments=='virus'">
                    Dangerous attachment found that blocks email delivery.
                </span>
            </td>
        </tr>
    </tbody>
</table>

<table class="table" ng-show="msg.x_aes_category">
    <thead>
        <tr>
            <th style="width: 100px;">Categroty</th>
            <th style="width: 70px;">State</th>
            <th>Info</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>SPF</td>
            <td>
                <span class="label"
                      ng-class="filter_class2(msg.filters.spf)">
                    {{ filter_label2(msg.filters.spf) }}
                </span>
            </td>
            <td>
                <span ng-if="msg.x_spf_status">
                    Status: {{ msg.x_spf_status }}
                </span>
            </td>
        </tr>
        <tr>
            <td>Black list</td>
            <td>
                <span class="label"
                      ng-class="filter_class2(msg.filters.white_black)">
                    {{ filter_label2(msg.filters.white_black) }}
                </span>
            </td>
            <td>
                <span ng-show="msg.filters.white_black=='black_list'">
                    Sender in black list
                </span>
            </td>
        </tr>
        <tr>
            <td>Phishing</td>
            <td>
                <span class="label"
                      ng-class="filter_class2(msg.filters.phishing)">
                    {{ filter_label2(msg.filters.phishing) }}
                </span>
            </td>
            <td></td>
        </tr>
        <tr>
            <td>ClamAV</td>
            <td>
                <span class="label"
                      ng-class="filter_class2(msg.filters.clamav)">
                    {{ filter_label2(msg.filters.clamav) }}
                </span>
            </td>
            <td>
                {{ filter_label_av(msg.filters.clamav) }}
            </td>
        </tr>
        <tr>
            <td>Cyren</td>
            <td>
                <span class="label"
                      ng-class="filter_class2(msg.filters.cyren)">
                    {{ filter_label2(msg.filters.cyren) }}
                </span>
            </td>
            <td>
                {{ filter_label_av(msg.filters.cyren) }}
            </td>
        </tr>
        <tr>
            <td>Sophos</td>
            <td>
                <span class="label"
                      ng-class="filter_class2(msg.filters.sophos)">
                    {{ filter_label2(msg.filters.sophos) }}
                </span>
            </td>
            <td>
                {{ filter_label_av(msg.filters.sophos) }}
            </td>
        </tr>
        <tr>
            <td>Cloudmark</td>
            <td>
                <span ng-if="msg.x_cmae_score">
                    <span class="label"
                          ng-class="filter_class2(msg.filters.cloudmark)">
                        {{ filter_label2(msg.filters.cloudmark) }}
                    </span>
                </span>
                <span ng-hide="msg.x_cmae_score">
                    <span class="label label-default">
                        Not applied
                    </span>
                </span>
            </td>
            <td>
                <span ng-if="msg.x_cmae_score">
                    Cloudmark spam score: {{ msg.x_cmae_score }}
                </span>
            </td>
        </tr>
        <tr>
            <td>VadeRetro</td>
            <td>
                <span class="label"
                      ng-class="filter_class2(msg.filters.vade_retro)">
                    {{ filter_label2(msg.filters.vade_retro) }}
                </span>
            </td>
            <td>
                <div ng-if="msg.x_spam_category">
                    <div>Category: {{ msg.x_spam_category }}</div>
                    <div>Score: {{ msg.x_spam_score }}</div>
                    <div style="word-break: break-all;">
                        Reasons: {{ msg.x_spam_reasons }}
                    </div>
                </div>
            </td>        </tr>
        <tr>
            <td>Attachments</td>
            <td>
                <span class="label"
                      ng-class="filter_class2(msg.filters.attachments)">
                    {{ filter_label2(msg.filters.attachments) }}
                </span>
            </td>
            <td>
                <span ng-if="msg.filters.attachments=='dangerous_attachment'">
                    Dangerous attachment found that blocks email delivery.
                </span>
            </td>
        </tr>
    </tbody>
</table>


<h3>Attachments</h3>
<p ng-hide="attachments.length">
    No attachments
</p>
<table class="table" ng-show="attachments.length">
    <thead>
        <tr>
            <th>Filename</th>
            <th>MimeType</th>
            <th>Size</th>
            <th>State</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr ng-repeat="attach in attachments">
            <td>{{ attach.ni_filename }}</td>
            <td>{{ attach.content_type }}</td>
            <td>{{ attach.content_size }}</td>
            <td>
                <span ng-if="attach.action=='accepted'"
                      class="label label-success">
                    Passed
                </span>
                <span ng-if="attach.action=='dropped'"
                      class="label label-warning">
                    Stripped
                </span>
            </td>
            <td>
                {{ attach.reason }}
            </td>
        </tr>
    </tbody>
</table>

<h3>Technical information</h3>
<table class="table">
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Policy name</td>
            <td>
                {{ msg.x_spam_stopper_policy }}
            </td>
        </tr>
        <tr>
            <td>Defects</td>
            <td>
                <span ng-repeat="defect in msg.defects">
                    {{ defect }}
                </span>
            </td>
        </tr>
        <tr>
            <td>AES Core version</td>
            <td>{{ msg.version }}</td>
        </tr>
        <tr>
            <td>Host</td>
            <td>{{ msg.host }}</td>
        </tr>
        <tr>
            <td>AES ID</td>
            <td>{{ msg.usr_message_id }}</td>
        </tr>
        <tr>
            <td>Client ID</td>
            <td>{{ msg.usr_client_mail_id }}</td>
        </tr>
        <tr>
            <td>Source IP</td>
            <td>{{ msg.source_ip }}</td>
        </tr>
        <tr>
            <td>SMTP Chain</td>
            <td>
                <span ng-repeat="relay in msg.smtp_chain">
                    {{ relay }}
                </span>
            </td>
        </tr>
        <tr>
            <td>Process time</td>
            <td>{{ msg.timings.total }}</td>
        </tr>
    </tbody>
</table>

<h3>Logs</h3>
<table class="table">
    <thead>
        <tr>
            <th>Time</th>
            <th>Logger</th>
            <th>Message</th>
        </tr>
    </thead>
    <tbody>
        <tr ng-repeat-start="log_msg in logs"
            ng-click="log_msg.show=!log_msg.show">
            <td>{{ log_msg.time }}</td>
            <td>{{ log_msg.logger_name }}</td>
            <td>{{ log_msg.message }}</td>
        </tr>
        <tr ng-repeat-end ng-if="log_msg.show">
            <td colspan="3">
                <table class="table">
                    <tr ng-repeat="(name,value) in log_msg"
                        ng-hide="name=='show'">
                        <td>{{ name }}</td>
                        <td>{{ value }}</td>
                    </tr>
                </table>
            </td>
        </tr>
    </tbody>
</table>