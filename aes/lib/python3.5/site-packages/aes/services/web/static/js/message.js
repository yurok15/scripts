app.controller("MessageInfoCtrl", ['$scope', '$http', '$stateParams',
    function ($scope, $http, $stateParams) {
        $scope.loaded = false;
        $http.get('/web_app', {'params':
            {
                'app': 'messages',
                'method': 'get_message_info',
                'message_id': $stateParams.pk
            }
        }).then(function successCallback(response) {
            $scope.msg = response.data.message;
            $scope.attachments = response.data.attachments;
            $scope.logs = response.data.logs;
            $scope.logs.forEach(function (item) {
                item.show = false;
            });
            $scope.loaded = true;
        });
        $scope.filter_label = function (state, f_name) {
            if (typeof state === "undefined") {
                return 'Not applied'
            }
            if (state=='passed') {
                return 'Passed'
            }
            if (state=='skipped') {
                return 'Whitelisted'
            }
            if (f_name=='cloudmark' && $scope.msg.x_spam_category) {
                return 'Passed'
            }
            return $scope.msg.delivery
        };
        $scope.filter_class = function (state, f_name) {
            if (typeof state === "undefined") {
                return 'label-default'
            }
            if (state=='passed') {
                return 'label-success'
            }
            if (state=='skipped') {
                return 'label-warning'
            }
            if (f_name=='cloudmark' && $scope.msg.x_spam_category) {
                return 'label-success'
            }
            return 'label-danger'
        };
        $scope.filter_class2 = function (state) {
            if (typeof state === "undefined") {
                return 'label-default'
            }
            if (state=='passed') {
                return 'label-success'
            }
            if (state=='skipped') {
                return 'label-warning'
            }
            return 'label-danger'
        };
        $scope.filter_label2 = function (state) {
            if (typeof state === "undefined") {
                return 'Not applied'
            }
            if (state=='passed') {
                return 'Passed'
            }
            if (state=='skipped') {
                return 'Whitelisted'
            }
            return $scope.msg.delivery
        };
        $scope.filter_label_av = function (state) {
            if (typeof state === "undefined") {
                return ''
            }
            if (state=='passed') {
                return ''
            }
            if (state=='skipped') {
                return ''
            }
            return 'Virus signature found: "' + state + '"'
        };
    }
    ]
);
