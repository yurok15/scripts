<link rel="stylesheet" href="/static/css/messages.css">
<div ui-view>
<div class="col-xs-12 panel panel-body">
    <form class="form-inline pull-left" style="width: 100%" ng-submit="refresh_all()">
      <div class="form-group dropdown">
          <button class="dropdown-toggle btn btn-sm"
                  data-toggle="dropdown" aria-haspopup="true"
                  aria-expanded="false" type="button" style="width: 100px"
                  ng-class="query_class">
              {{ query_type }}
              <span class="caret"></span>
          </button >
          <ul class="dropdown-menu">
              <li ng-repeat="(sub_item_name, sub_item_value) in query_values">
                  <a ng-click="set_query_type(sub_item_name)"
                     ng-show="sub_item_name != query_type">
                      {{ sub_item_name }}
                  </a>
              </li>
          </ul>
      </div>
      <div class="form-group">

          <label class="control-label">From:</label>
          <input type="text" ng-model="$parent.from_filter" id="from_filter"
               class="form-control" type="text">
      </div>
      <div class="form-group">

          <label class="control-label">To:</label>
          <input type="text" ng-model="$parent.to_filter" id="to_filter"
               class="form-control" type="text">
      </div>
      <div class="form-group">

          <label class="control-label">ID:</label>
          <input type="text" ng-model="$parent.id_filter" id="id_filter"
               class="form-control" type="text">
      </div>

      <div class="form-group">
          <button class="btn btn-sm btn-warning" ng-click="refresh_all()">
              <span class="glyphicon glyphicon-refresh" aria-hidden="true">
              </span>
          </button>
      </div>
      <div class="form-group pull-right dropdown">

              <button class="btn btn-sm btn-default dropdown-toggle"
                      data-toggle="dropdown" role="button"
                      aria-haspopup="true" aria-expanded="false">
                  <span class="glyphicon glyphicon-time" aria-hidden="true">
                  </span>
                  {{ time_filter }}
                  <span class="caret"></span>
              </button>
              <ul class="dropdown-menu">
                  <li ng-repeat="(name, time) in time_values">
                      <a ng-click="set_time(name)">
                          {{ name }}
                      </a>
                  </li>
              </ul>
      </div>

    </form>
    <div ng-if="show_time">
      sdfsdfsd
    </div>
</div>
<div class="col-xs-12 panel panel-body">
    <nvd3 options='options' data='graph_data'></nvd3>
</div>

<div class="col-xs-12 panel panel-body">
    <div class="row">
        <div class="col-xs-3">
            <div ng-show="loading_aggs">
                <div class="cssload-loader">
                    <div class="cssload-inner cssload-one"></div>
                    <div class="cssload-inner cssload-two"></div>
                    <div class="cssload-inner cssload-three"></div>
                </div>
            </div>
            <table class="table table-hover" ng-hide="loading_aggs">
                <thead>
                    <tr>
                        <th>
                            <span class="glyphicon glyphicon-log-out"
                                  aria-hidden="true" title="Sender domains">
                            </span>
                            Sender
                        </th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="domain in sender_domains"
                        ng-click="toggle_sender_domain(domain.key)"
                        ng-class="sender_domain_class(domain.key)"
                    >
                        <td>{{ domain.key }}</td>
                        <td style="text-align: right">
                            {{ domain.doc_count }}
                        </td>
                    </tr>
                    <tr ng-hide="sender_domains.length">
                        <td colspan="2">
                            Empty
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-hover" ng-hide="loading_aggs">
                <thead>
                    <tr>
                        <th>
                            <span class="glyphicon glyphicon-log-in"
                                  aria-hidden="true" title="Recipient domains">
                            </span>
                            Recipient
                        </th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="domain in recipient_domains"
                        ng-click="toggle_recipient_domain(domain.key)"
                        ng-class="recipient_domain_class(domain.key)">
                        <td>{{ domain.key }}</td>
                        <td style="text-align: right">
                            {{ domain.doc_count }}
                        </td>
                    </tr>
                    <tr ng-hide="recipient_domains.length">
                        <td colspan="2">
                            Empty
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table" ng-hide="loading_table">
                <thead>
                    <tr>
                        <th>Total</th>
                        <th style="text-align: right">{{ total_records }}</th>
                    </tr>
                </thead>
            </table>
        </div>
        <span class="col-xs-9">
            <div ng-show="loading_table">
                <div class="cssload-loader">
                    <div class="cssload-inner cssload-one"></div>
                    <div class="cssload-inner cssload-two"></div>
                    <div class="cssload-inner cssload-three"></div>
                </div>
            </div>
            <table class="table table-striped table-hover"
                   ng-hide="loading_table">
                <thead>
                    <tr>
                        <th ng-click="check_all()">
                            <input type="checkbox" ng-model="select_toggler">
                        </th>
                        <th ng-click="toggle_order('@timestamp')">
                            Time
                            <span ng-show="sort_field=='@timestamp'">
                                <span class="glyphicon glyphicon-arrow-down"
                                      ng-show="sort_direction=='desc'">
                                </span>
                                <span class="glyphicon glyphicon-arrow-up"
                                      ng-show="sort_direction=='asc'">
                                </span>
                            </span>
                        </th>
                        <th ng-click="toggle_order('delivery')">
                            Delivery
                            <span ng-show="sort_field=='delivery'">
                                <span class="glyphicon glyphicon-arrow-down"
                                      ng-show="sort_direction=='desc'">
                                </span>
                                <span class="glyphicon glyphicon-arrow-up"
                                      ng-show="sort_direction=='asc'">
                                </span>
                            </span>
                        </th>
                        <th ng-click="toggle_order('usr_mail_from')">
                            From
                            <span ng-show="sort_field=='usr_mail_from'">
                                <span class="glyphicon glyphicon-arrow-down"
                                      ng-show="sort_direction=='desc'">
                                </span>
                                <span class="glyphicon glyphicon-arrow-up"
                                      ng-show="sort_direction=='asc'">
                                </span>
                            </span>
                        </th>
                        <th ng-click="toggle_order('usr_mail_to')">
                            To
                            <span ng-show="sort_field=='usr_mail_to'">
                                <span class="glyphicon glyphicon-arrow-down"
                                      ng-show="sort_direction=='desc'">
                                </span>
                                <span class="glyphicon glyphicon-arrow-up"
                                      ng-show="sort_direction=='asc'">
                                </span>
                            </span>
                        </th>
                        <th ng-click="toggle_order('inbound_attachments_count')">
                           <span class="glyphicon glyphicon-paperclip" aria-hidden="true">
                           </span>
                            <span ng-show="sort_field=='inbound_attachments_count'">
                                <span class="glyphicon glyphicon-arrow-down"
                                      ng-show="sort_direction=='desc'">
                                </span>
                                <span class="glyphicon glyphicon-arrow-up"
                                      ng-show="sort_direction=='asc'">
                                </span>
                            </span>
                        </th>
                        <th ng-click="toggle_order('out_size_kb')">
                            Size
                            <span ng-show="sort_field=='out_size_kb'">
                                <span class="glyphicon glyphicon-arrow-down"
                                      ng-show="sort_direction=='desc'">
                                </span>
                                <span class="glyphicon glyphicon-arrow-up"
                                      ng-show="sort_direction=='asc'">
                                </span>
                            </span>
                        </th>
                        <th>

                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="node in data track by $index">
                        <td ng-click="select_item()">
                            <input type="checkbox" ng-model="node.checked">
                        </td>
                        <td title="{{ node.usr_message_id }}"
                            ui-sref=".info({pk: node.usr_message_id })">
                            {{ node.time }}
                        </td>
                        <td ui-sref=".info({pk: node.usr_message_id })">
                            <span class="label"
                                  ng-class="delivery_class(node)">
                                {{ node.delivery }}
                            </span>
                        </td>
                        <td title="{{ node.usr_client_mail_id }}"
                            ui-sref=".info({pk: node.usr_message_id })">
                            {{ node.usr_mail_from }}
                        </td>
                        <td title="{{ node.usr_message_id }}"
                            ui-sref=".info({pk: node.usr_message_id })">
                            {{ node.usr_mail_to }}
                        </td>
                        <td ui-sref=".info({pk: node.usr_message_id })">
                            {{ node.inbound_attachments_count }}
                        </td>
                        <td ui-sref=".info({pk: node.usr_message_id })">
                            {{ node.size }}
                        </td>
                        <td>
                            <div ng-if="node.actions">
                            </div>
                            <span class="btn btn-sm btn-default" ng-if="node.loading">
                                <span class="glyphicon glyphicon-hourglass" aria-hidden="true">
                                </span>
                            </span>
                            <span ng-if="node.report" class="btn btn-sm"
                                  ng-class="node.report_class"
                                  title="{{ node.report_text }}"
                                  ng-click="node.actions=true;
                                  node.report=false;">
                                <span class="glyphicon" aria-hidden="true"
                                      ng-class="node.report_icon">
                                </span>
                            </span>
                        </td>

                    </tr>
                    <tr>
                        <td colspan="8" ng-hide="data.length">
                            Empty
                        </td>
                    </tr>
                    <tr ng-show="data.length">
                        <td colspan="2">
                            <button class="btn btn-sm" ng-click="unloop()"
                                    ng-class="{true:'btn-primary', false:
                                    'btn-default disabled'}[can_unloop]">
                                <span class="glyphicon glyphicon-play" aria-hidden="true">
                                </span>
                                Unloop
                            </button>
                        </td>
                        <td colspan="6">
                            <div class="col-xs-4">
                                <button class="btn btn-sm btn-default"
                                        ng-click="set_page(1)">
                                    <span class="glyphicon glyphicon-fast-backward" aria-hidden="true">
                                    </span>
                                </button>
                                <button class="btn btn-sm btn-default"
                                        ng-click="set_page(page - 1)">
                                    <span class="glyphicon glyphicon-backward" aria-hidden="true">
                                    </span>
                                </button>
                            </div>
                            <div class="col-xs-5" style="text-align: center">
                                Page {{ page }} / {{ pages }}
                            </div>
                            <div class="col-xs-3">
                                <button class="btn btn-sm btn-default pull-right"
                                        ng-click="set_page(page + 1)">
                                    <span class="glyphicon glyphicon-forward" aria-hidden="true">
                                    </span>
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </span>
    </div>
</div>
</div>
