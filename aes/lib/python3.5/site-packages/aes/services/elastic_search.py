from elasticsearch import Elasticsearch

from aes.core.controller import BaseService


def modify_date(timestamp):
    if timestamp:
        return timestamp[:19].replace('T', ' ')
    return 'Unknown'


class ElasticSearchService(BaseService):
    config_required = True

    def __init__(self, name, controller, config, loop):
        super(ElasticSearchService, self).__init__(
            name, controller, config, loop)
        self._es = Elasticsearch(
            config['hosts'],
            http_auth=config['auth'],
            verify_certs=False,
            timeout=config['timeout'],
        )
        self.indexes = config['indexes']

    async def search(self, index, body):
        return await self.loop.run_in_executor(
            None,
            self._es.search, index, None, body
        )

    async def get(self, index, pk):
        return await self.loop.run_in_executor(
            None,
            self._es.get, index, pk
        )
